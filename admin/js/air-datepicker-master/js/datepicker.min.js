/*
 * @author Mixail Sayapin
 * https://ms-web.ru
 */

(function(a,b,c){(function(){var n="2.2.3",j="datepicker",h=".datepicker-here",e,g,l=false,m='<div class="datepicker"><i class="datepicker--pointer"></i><nav class="datepicker--nav"></nav><div class="datepicker--content"></div></div>',d={classes:"",inline:false,language:"ru",startDate:new Date(),firstDay:"",weekends:[6,0],dateFormat:"",altField:"",altFieldDateFormat:"@",toggleSelected:true,keyboardNav:true,position:"bottom left",offset:12,view:"days",minView:"days",showOtherMonths:true,selectOtherMonths:true,moveToOtherMonthsOnSelect:true,showOtherYears:true,selectOtherYears:true,moveToOtherYearsOnSelect:true,minDate:"",maxDate:"",disableNavWhenOutOfRange:true,multipleDates:false,multipleDatesSeparator:",",range:false,todayButton:false,clearButton:false,showEvent:"focus",autoClose:false,monthsField:"monthsShort",prevHtml:'<svg><path d="M 17,12 l -5,5 l 5,5"></path></svg>',nextHtml:'<svg><path d="M 14,12 l 5,5 l -5,5"></path></svg>',navTitles:{days:"MM, <i>yyyy</i>",months:"yyyy",years:"yyyy1 - yyyy2"},timepicker:false,onlyTimepicker:false,dateTimeSeparator:" ",timeFormat:"",minHours:0,maxHours:24,minMinutes:0,maxMinutes:59,hoursStep:1,minutesStep:1,onSelect:"",onShow:"",onHide:"",onChangeMonth:"",onChangeYear:"",onChangeDecade:"",onChangeView:"",onRenderCell:""},k={ctrlRight:[17,39],ctrlUp:[17,38],ctrlLeft:[17,37],ctrlDown:[17,40],shiftRight:[16,39],shiftUp:[16,38],shiftLeft:[16,37],shiftDown:[16,40],altUp:[18,38],altRight:[18,39],altLeft:[18,37],altDown:[18,40],ctrlShiftUp:[16,17,38]},i;var f=function(p,o){this.el=p;this.$el=b(p);this.opts=b.extend(true,{},d,o,this.$el.data());if(e==c){e=b("body")}if(!this.opts.startDate){this.opts.startDate=new Date()}if(this.el.nodeName=="INPUT"){this.elIsInput=true}if(this.opts.altField){this.$altField=typeof this.opts.altField=="string"?b(this.opts.altField):this.opts.altField}this.inited=false;this.visible=false;this.silent=false;this.currentDate=this.opts.startDate;this.currentView=this.opts.view;this._createShortCuts();this.selectedDates=[];this.views={};this.keys=[];this.minRange="";this.maxRange="";this._prevOnSelectValue="";this.init()};i=f;i.prototype={VERSION:n,viewIndexes:["days","months","years"],init:function(){if(!l&&!this.opts.inline&&this.elIsInput){this._buildDatepickersContainer()}this._buildBaseHtml();this._defineLocale(this.opts.language);this._syncWithMinMaxDates();if(this.elIsInput){if(!this.opts.inline){this._setPositionClasses(this.opts.position);this._bindEvents()}if(this.opts.keyboardNav&&!this.opts.onlyTimepicker){this._bindKeyboardEvents()}this.$datepicker.on("mousedown",this._onMouseDownDatepicker.bind(this));this.$datepicker.on("mouseup",this._onMouseUpDatepicker.bind(this))}if(this.opts.classes){this.$datepicker.addClass(this.opts.classes)}if(this.opts.timepicker){this.timepicker=new b.fn.datepicker.Timepicker(this,this.opts);this._bindTimepickerEvents()}if(this.opts.onlyTimepicker){this.$datepicker.addClass("-only-timepicker-")}this.views[this.currentView]=new b.fn.datepicker.Body(this,this.currentView,this.opts);this.views[this.currentView].show();this.nav=new b.fn.datepicker.Navigation(this,this.opts);this.view=this.currentView;this.$el.on("clickCell.adp",this._onClickCell.bind(this));this.$datepicker.on("mouseenter",".datepicker--cell",this._onMouseEnterCell.bind(this));this.$datepicker.on("mouseleave",".datepicker--cell",this._onMouseLeaveCell.bind(this));this.inited=true},_createShortCuts:function(){this.minDate=this.opts.minDate?this.opts.minDate:new Date(-8639999913600000);this.maxDate=this.opts.maxDate?this.opts.maxDate:new Date(8639999913600000)},_bindEvents:function(){this.$el.on(this.opts.showEvent+".adp",this._onShowEvent.bind(this));this.$el.on("mouseup.adp",this._onMouseUpEl.bind(this));this.$el.on("blur.adp",this._onBlur.bind(this));this.$el.on("keyup.adp",this._onKeyUpGeneral.bind(this));b(a).on("resize.adp",this._onResize.bind(this));b("body").on("mouseup.adp",this._onMouseUpBody.bind(this))},_bindKeyboardEvents:function(){this.$el.on("keydown.adp",this._onKeyDown.bind(this));this.$el.on("keyup.adp",this._onKeyUp.bind(this));this.$el.on("hotKey.adp",this._onHotKey.bind(this))},_bindTimepickerEvents:function(){this.$el.on("timeChange.adp",this._onTimeChange.bind(this))},isWeekend:function(o){return this.opts.weekends.indexOf(o)!==-1},_defineLocale:function(o){if(typeof o=="string"){this.loc=b.fn.datepicker.language[o];if(!this.loc){console.warn("Can't find language \""+o+'" in Datepicker.language, will use "ru" instead');this.loc=b.extend(true,{},b.fn.datepicker.language.ru)}this.loc=b.extend(true,{},b.fn.datepicker.language.ru,b.fn.datepicker.language[o])}else{this.loc=b.extend(true,{},b.fn.datepicker.language.ru,o)}if(this.opts.dateFormat){this.loc.dateFormat=this.opts.dateFormat}if(this.opts.timeFormat){this.loc.timeFormat=this.opts.timeFormat}if(this.opts.firstDay!==""){this.loc.firstDay=this.opts.firstDay}if(this.opts.timepicker){this.loc.dateFormat=[this.loc.dateFormat,this.loc.timeFormat].join(this.opts.dateTimeSeparator)}if(this.opts.onlyTimepicker){this.loc.dateFormat=this.loc.timeFormat}var p=this._getWordBoundaryRegExp;if(this.loc.timeFormat.match(p("aa"))||this.loc.timeFormat.match(p("AA"))){this.ampm=true}},_buildDatepickersContainer:function(){l=true;e.append('<div class="datepickers-container" id="datepickers-container"></div>');g=b("#datepickers-container")},_buildBaseHtml:function(){var p,o=b('<div class="datepicker-inline">');if(this.el.nodeName=="INPUT"){if(!this.opts.inline){p=g}else{p=o.insertAfter(this.$el)}}else{p=o.appendTo(this.$el)}this.$datepicker=b(m).appendTo(p);this.$content=b(".datepicker--content",this.$datepicker);this.$nav=b(".datepicker--nav",this.$datepicker)},_triggerOnChange:function(){if(!this.selectedDates.length){if(this._prevOnSelectValue===""){return}this._prevOnSelectValue="";return this.opts.onSelect("","",this)}var o=this.selectedDates,s=i.getParsedDate(o[0]),p,r=this,q=new Date(s.year,s.month,s.date,s.hours,s.minutes);p=o.map(function(t){return r.formatDate(r.loc.dateFormat,t)}).join(this.opts.multipleDatesSeparator);if(this.opts.multipleDates||this.opts.range){q=o.map(function(t){var u=i.getParsedDate(t);return new Date(u.year,u.month,u.date,u.hours,u.minutes)})}this._prevOnSelectValue=p;this.opts.onSelect(p,q,this)},next:function(){var q=this.parsedDate,p=this.opts;switch(this.view){case"days":this.date=new Date(q.year,q.month+1,1);if(p.onChangeMonth){p.onChangeMonth(this.parsedDate.month,this.parsedDate.year)}break;case"months":this.date=new Date(q.year+1,q.month,1);if(p.onChangeYear){p.onChangeYear(this.parsedDate.year)}break;case"years":this.date=new Date(q.year+10,0,1);if(p.onChangeDecade){p.onChangeDecade(this.curDecade)}break}},prev:function(){var q=this.parsedDate,p=this.opts;switch(this.view){case"days":this.date=new Date(q.year,q.month-1,1);if(p.onChangeMonth){p.onChangeMonth(this.parsedDate.month,this.parsedDate.year)}break;case"months":this.date=new Date(q.year-1,q.month,1);if(p.onChangeYear){p.onChangeYear(this.parsedDate.year)}break;case"years":this.date=new Date(q.year-10,0,1);if(p.onChangeDecade){p.onChangeDecade(this.curDecade)}break}},formatDate:function(u,q){q=q||this.date;var B=u,p=this._getWordBoundaryRegExp,y=this.loc,z=i.getLeadingZeroNum,A=i.getDecade(q),v=i.getParsedDate(q),t=v.fullHours,x=v.hours,w=u.match(p("aa"))||u.match(p("AA")),r="am",s=this._replacer,o;if(this.opts.timepicker&&this.timepicker&&w){o=this.timepicker._getValidHoursFromDate(q,w);t=z(o.hours);x=o.hours;r=o.dayPeriod}switch(true){case /@/.test(B):B=B.replace(/@/,q.getTime());case /aa/.test(B):B=s(B,p("aa"),r);case /AA/.test(B):B=s(B,p("AA"),r.toUpperCase());case /dd/.test(B):B=s(B,p("dd"),v.fullDate);case /d/.test(B):B=s(B,p("d"),v.date);case /DD/.test(B):B=s(B,p("DD"),y.days[v.day]);case /D/.test(B):B=s(B,p("D"),y.daysShort[v.day]);case /mm/.test(B):B=s(B,p("mm"),v.fullMonth);case /m/.test(B):B=s(B,p("m"),v.month+1);case /MM/.test(B):B=s(B,p("MM"),this.loc.months[v.month]);case /M/.test(B):B=s(B,p("M"),y.monthsShort[v.month]);case /ii/.test(B):B=s(B,p("ii"),v.fullMinutes);case /i/.test(B):B=s(B,p("i"),v.minutes);case /hh/.test(B):B=s(B,p("hh"),t);case /h/.test(B):B=s(B,p("h"),x);case /yyyy/.test(B):B=s(B,p("yyyy"),v.year);case /yyyy1/.test(B):B=s(B,p("yyyy1"),A[0]);case /yyyy2/.test(B):B=s(B,p("yyyy2"),A[1]);case /yy/.test(B):B=s(B,p("yy"),v.year.toString().slice(-2))}return B},_replacer:function(q,o,p){return q.replace(o,function(r,u,t,s){return u+p+s})},_getWordBoundaryRegExp:function(o){var p="\\s|\\.|-|/|\\\\|,|\\$|\\!|\\?|:|;";return new RegExp("(^|>|"+p+")("+o+")($|<|"+p+")","g")},selectDate:function(q){var u=this,s=u.opts,t=u.parsedDate,r=u.selectedDates,o=r.length,p="";if(Array.isArray(q)){q.forEach(function(v){u.selectDate(v)});return}if(!(q instanceof Date)){return}this.lastSelectedDate=q;if(this.timepicker){this.timepicker._setTime(q)}u._trigger("selectDate",q);if(this.timepicker){q.setHours(this.timepicker.hours);q.setMinutes(this.timepicker.minutes)}if(u.view=="days"){if(q.getMonth()!=t.month&&s.moveToOtherMonthsOnSelect){p=new Date(q.getFullYear(),q.getMonth(),1)}}if(u.view=="years"){if(q.getFullYear()!=t.year&&s.moveToOtherYearsOnSelect){p=new Date(q.getFullYear(),0,1)}}if(p){u.silent=true;u.date=p;u.silent=false;u.nav._render()}if(s.multipleDates&&!s.range){if(o===s.multipleDates){return}if(!u._isSelected(q)){u.selectedDates.push(q)}}else{if(s.range){if(o==2){u.selectedDates=[q];u.minRange=q;u.maxRange=""}else{if(o==1){u.selectedDates.push(q);if(!u.maxRange){u.maxRange=q}else{u.minRange=q}if(i.bigger(u.maxRange,u.minRange)){u.maxRange=u.minRange;u.minRange=q}u.selectedDates=[u.minRange,u.maxRange]}else{u.selectedDates=[q];u.minRange=q}}}else{u.selectedDates=[q]}}u._setInputValue();if(s.onSelect){u._triggerOnChange()}if(s.autoClose&&!this.timepickerIsActive){if(!s.multipleDates&&!s.range){u.hide()}else{if(s.range&&u.selectedDates.length==2){u.hide()}}}u.views[this.currentView]._render()},removeDate:function(o){var p=this.selectedDates,q=this;if(!(o instanceof Date)){return}return p.some(function(r,s){if(i.isSame(r,o)){p.splice(s,1);if(!q.selectedDates.length){q.minRange="";q.maxRange="";q.lastSelectedDate=""}else{q.lastSelectedDate=q.selectedDates[q.selectedDates.length-1]}q.views[q.currentView]._render();q._setInputValue();if(q.opts.onSelect){q._triggerOnChange()}return true}})},today:function(){this.silent=true;this.view=this.opts.minView;this.silent=false;this.date=new Date();if(this.opts.todayButton instanceof Date){this.selectDate(this.opts.todayButton)}},clear:function(){this.selectedDates=[];this.minRange="";this.maxRange="";this.views[this.currentView]._render();this._setInputValue();if(this.opts.onSelect){this._triggerOnChange()}},update:function(r,q){var o=arguments.length,p=this.lastSelectedDate;if(o==2){this.opts[r]=q}else{if(o==1&&typeof r=="object"){this.opts=b.extend(true,this.opts,r)}}this._createShortCuts();this._syncWithMinMaxDates();this._defineLocale(this.opts.language);this.nav._addButtonsIfNeed();if(!this.opts.onlyTimepicker){this.nav._render()}this.views[this.currentView]._render();if(this.elIsInput&&!this.opts.inline){this._setPositionClasses(this.opts.position);if(this.visible){this.setPosition(this.opts.position)}}if(this.opts.classes){this.$datepicker.addClass(this.opts.classes)}if(this.opts.onlyTimepicker){this.$datepicker.addClass("-only-timepicker-")}if(this.opts.timepicker){if(p){this.timepicker._handleDate(p)}this.timepicker._updateRanges();this.timepicker._updateCurrentTime();if(p){p.setHours(this.timepicker.hours);p.setMinutes(this.timepicker.minutes)}}this._setInputValue();return this},_syncWithMinMaxDates:function(){var o=this.date.getTime();this.silent=true;if(this.minTime>o){this.date=this.minDate}if(this.maxTime<o){this.date=this.maxDate}this.silent=false},_isSelected:function(q,o){var p=false;this.selectedDates.some(function(r){if(i.isSame(r,q,o)){p=r;return true}});return p},_setInputValue:function(){var t=this,q=t.opts,s=t.loc.dateFormat,p=q.altFieldDateFormat,r=t.selectedDates.map(function(u){return t.formatDate(s,u)}),o;if(q.altField&&t.$altField.length){o=this.selectedDates.map(function(u){return t.formatDate(p,u)});o=o.join(this.opts.multipleDatesSeparator);this.$altField.val(o)}r=r.join(this.opts.multipleDatesSeparator);this.$el.val(r)},_isInRange:function(q,u){var p=q.getTime(),t=i.getParsedDate(q),r=i.getParsedDate(this.minDate),v=i.getParsedDate(this.maxDate),o=new Date(t.year,t.month,r.date).getTime(),w=new Date(t.year,t.month,v.date).getTime(),s={day:p>=this.minTime&&p<=this.maxTime,month:o>=this.minTime&&w<=this.maxTime,year:t.year>=r.year&&t.year<=v.year};return u?s[u]:s.day},_getDimensions:function(o){var p=o.offset();return{width:o.outerWidth(),height:o.outerHeight(),left:p.left,top:p.top}},_getDateFromCell:function(o){var p=this.parsedDate,r=o.data("year")||p.year,s=o.data("month")==c?p.month:o.data("month"),q=o.data("date")||1;return new Date(r,s,q)},_setPositionClasses:function(r){r=r.split(" ");var o=r[0],q=r[1],p="datepicker -"+o+"-"+q+"- -from-"+o+"-";if(this.visible){p+=" active"}this.$datepicker.removeAttr("class").addClass(p)},setPosition:function(r){r=r||this.opts.position;var v=this._getDimensions(this.$el),s=this._getDimensions(this.$datepicker),t=r.split(" "),u,o,q=this.opts.offset,p=t[0],w=t[1];switch(p){case"top":u=v.top-s.height-q;break;case"right":o=v.left+v.width+q;break;case"bottom":u=v.top+v.height+q;break;case"left":o=v.left-s.width-q;break}switch(w){case"top":u=v.top;break;case"right":o=v.left+v.width-s.width;break;case"bottom":u=v.top+v.height-s.height;break;case"left":o=v.left;break;case"center":if(/left|right/.test(p)){u=v.top+v.height/2-s.height/2}else{o=v.left+v.width/2-s.width/2}}this.$datepicker.css({left:o,top:u})},show:function(){var o=this.opts.onShow;this.setPosition(this.opts.position);this.$datepicker.addClass("active");this.visible=true;if(o){this._bindVisionEvents(o)}},hide:function(){var o=this.opts.onHide;this.$datepicker.removeClass("active").css({left:"-100000px"});this.focused="";this.keys=[];this.inFocus=false;this.visible=false;this.$el.blur();if(o){this._bindVisionEvents(o)}},down:function(o){this._changeView(o,"down")},up:function(o){this._changeView(o,"up")},_bindVisionEvents:function(o){this.$datepicker.off("transitionend.dp");o(this,false);this.$datepicker.one("transitionend.dp",o.bind(this,this,true))},_changeView:function(p,o){p=p||this.focused||this.date;var q=o=="up"?this.viewIndex+1:this.viewIndex-1;if(q>2){q=2}if(q<0){q=0}this.silent=true;this.date=new Date(p.getFullYear(),p.getMonth(),1);this.silent=false;this.view=this.viewIndexes[q]},_handleHotKey:function(B){var u=i.getParsedDate(this._getFocusedDate()),r,p=this.opts,A,t,q=false,v=false,z=false,x=u.year,s=u.month,w=u.date;switch(B){case"ctrlRight":case"ctrlUp":s+=1;q=true;break;case"ctrlLeft":case"ctrlDown":s-=1;q=true;break;case"shiftRight":case"shiftUp":v=true;x+=1;break;case"shiftLeft":case"shiftDown":v=true;x-=1;break;case"altRight":case"altUp":z=true;x+=10;break;case"altLeft":case"altDown":z=true;x-=10;break;case"ctrlShiftUp":this.up();break}t=i.getDaysCount(new Date(x,s));A=new Date(x,s,w);if(t<w){w=t}if(A.getTime()<this.minTime){A=this.minDate}else{if(A.getTime()>this.maxTime){A=this.maxDate}}this.focused=A;r=i.getParsedDate(A);if(q&&p.onChangeMonth){p.onChangeMonth(r.month,r.year)}if(v&&p.onChangeYear){p.onChangeYear(r.year)}if(z&&p.onChangeDecade){p.onChangeDecade(this.curDecade)}},_registerKey:function(o){var p=this.keys.some(function(q){return q==o});if(!p){this.keys.push(o)}},_unRegisterKey:function(p){var o=this.keys.indexOf(p);this.keys.splice(o,1)},_isHotKeyPressed:function(){var o,r=false,s=this,p=this.keys.sort();for(var q in k){o=k[q];if(p.length!=o.length){continue}if(o.every(function(u,t){return u==p[t]})){s._trigger("hotKey",q);r=true}}return r},_trigger:function(p,o){this.$el.trigger(p,o)},_focusNextCell:function(r,q){q=q||this.cellType;var p=i.getParsedDate(this._getFocusedDate()),u=p.year,o=p.month,t=p.date;if(this._isHotKeyPressed()){return}switch(r){case 37:q=="day"?(t-=1):"";q=="month"?(o-=1):"";q=="year"?(u-=1):"";break;case 38:q=="day"?(t-=7):"";q=="month"?(o-=3):"";q=="year"?(u-=4):"";break;case 39:q=="day"?(t+=1):"";q=="month"?(o+=1):"";q=="year"?(u+=1):"";break;case 40:q=="day"?(t+=7):"";q=="month"?(o+=3):"";q=="year"?(u+=4):"";break}var s=new Date(u,o,t);if(s.getTime()<this.minTime){s=this.minDate}else{if(s.getTime()>this.maxTime){s=this.maxDate}}this.focused=s},_getFocusedDate:function(){var o=this.focused||this.selectedDates[this.selectedDates.length-1],p=this.parsedDate;if(!o){switch(this.view){case"days":o=new Date(p.year,p.month,new Date().getDate());break;case"months":o=new Date(p.year,p.month,1);break;case"years":o=new Date(p.year,0,1);break}}return o},_getCell:function(p,q){q=q||this.cellType;var s=i.getParsedDate(p),o='.datepicker--cell[data-year="'+s.year+'"]',r;switch(q){case"month":o='[data-month="'+s.month+'"]';break;case"day":o+='[data-month="'+s.month+'"][data-date="'+s.date+'"]';break}r=this.views[this.currentView].$el.find(o);return r.length?r:b("")},destroy:function(){var o=this;o.$el.off(".adp").data("datepicker","");o.selectedDates=[];o.focused="";o.views={};o.keys=[];o.minRange="";o.maxRange="";if(o.opts.inline||!o.elIsInput){o.$datepicker.closest(".datepicker-inline").remove()}else{o.$datepicker.remove()}},_handleAlreadySelectedDates:function(o,p){if(this.opts.range){if(!this.opts.toggleSelected){if(this.selectedDates.length!=2){this._trigger("clickCell",p)}}else{this.removeDate(p)}}else{if(this.opts.toggleSelected){this.removeDate(p)}}if(!this.opts.toggleSelected){this.lastSelectedDate=o;if(this.opts.timepicker){this.timepicker._setTime(o);this.timepicker.update()}}},_onShowEvent:function(o){if(!this.visible){this.show()}},_onBlur:function(){if(!this.inFocus&&this.visible){this.hide()}},_onMouseDownDatepicker:function(o){this.inFocus=true},_onMouseUpDatepicker:function(o){this.inFocus=false;o.originalEvent.inFocus=true;if(!o.originalEvent.timepickerFocus){this.$el.focus()}},_onKeyUpGeneral:function(o){var p=this.$el.val();if(!p){this.clear()}},_onResize:function(){if(this.visible){this.setPosition()}},_onMouseUpBody:function(o){if(o.originalEvent.inFocus){return}if(this.visible&&!this.inFocus){this.hide()}},_onMouseUpEl:function(o){o.originalEvent.inFocus=true;setTimeout(this._onKeyUpGeneral.bind(this),4)},_onKeyDown:function(q){var p=q.which;this._registerKey(p);if(p>=37&&p<=40){q.preventDefault();this._focusNextCell(p)}if(p==13){if(this.focused){if(this._getCell(this.focused).hasClass("-disabled-")){return}if(this.view!=this.opts.minView){this.down()}else{var o=this._isSelected(this.focused,this.cellType);if(!o){if(this.timepicker){this.focused.setHours(this.timepicker.hours);this.focused.setMinutes(this.timepicker.minutes)}this.selectDate(this.focused);return}this._handleAlreadySelectedDates(o,this.focused)}}}if(p==27){this.hide()}},_onKeyUp:function(p){var o=p.which;this._unRegisterKey(o)},_onHotKey:function(p,o){this._handleHotKey(o)},_onMouseEnterCell:function(q){var p=b(q.target).closest(".datepicker--cell"),o=this._getDateFromCell(p);this.silent=true;if(this.focused){this.focused=""}p.addClass("-focus-");this.focused=o;this.silent=false;if(this.opts.range&&this.selectedDates.length==1){this.minRange=this.selectedDates[0];this.maxRange="";if(i.less(this.minRange,this.focused)){this.maxRange=this.minRange;this.minRange=""}this.views[this.currentView]._update()}},_onMouseLeaveCell:function(p){var o=b(p.target).closest(".datepicker--cell");o.removeClass("-focus-");this.silent=true;this.focused="";this.silent=false},_onTimeChange:function(t,s,o){var p=new Date(),r=this.selectedDates,q=false;if(r.length){q=true;p=this.lastSelectedDate}p.setHours(s);p.setMinutes(o);if(!q&&!this._getCell(p).hasClass("-disabled-")){this.selectDate(p)}else{this._setInputValue();if(this.opts.onSelect){this._triggerOnChange()}}},_onClickCell:function(p,o){if(this.timepicker){o.setHours(this.timepicker.hours);o.setMinutes(this.timepicker.minutes)}this.selectDate(o)},set focused(p){if(!p&&this.focused){var o=this._getCell(this.focused);if(o.length){o.removeClass("-focus-")}}this._focused=p;if(this.opts.range&&this.selectedDates.length==1){this.minRange=this.selectedDates[0];this.maxRange="";if(i.less(this.minRange,this._focused)){this.maxRange=this.minRange;this.minRange=""}}if(this.silent){return}this.date=p},get focused(){return this._focused},get parsedDate(){return i.getParsedDate(this.date)},set date(o){if(!(o instanceof Date)){return}this.currentDate=o;if(this.inited&&!this.silent){this.views[this.view]._render();this.nav._render();if(this.visible&&this.elIsInput){this.setPosition()}}return o},get date(){return this.currentDate},set view(o){this.viewIndex=this.viewIndexes.indexOf(o);if(this.viewIndex<0){return}this.prevView=this.currentView;this.currentView=o;if(this.inited){if(!this.views[o]){this.views[o]=new b.fn.datepicker.Body(this,o,this.opts)}else{this.views[o]._render()}this.views[this.prevView].hide();this.views[o].show();this.nav._render();if(this.opts.onChangeView){this.opts.onChangeView(o)}if(this.elIsInput&&this.visible){this.setPosition()}}return o},get view(){return this.currentView},get cellType(){return this.view.substring(0,this.view.length-1)},get minTime(){var o=i.getParsedDate(this.minDate);return new Date(o.year,o.month,o.date).getTime()},get maxTime(){var o=i.getParsedDate(this.maxDate);return new Date(o.year,o.month,o.date).getTime()},get curDecade(){return i.getDecade(this.date)}};i.getDaysCount=function(o){return new Date(o.getFullYear(),o.getMonth()+1,0).getDate()};i.getParsedDate=function(o){return{year:o.getFullYear(),month:o.getMonth(),fullMonth:(o.getMonth()+1)<10?"0"+(o.getMonth()+1):o.getMonth()+1,date:o.getDate(),fullDate:o.getDate()<10?"0"+o.getDate():o.getDate(),day:o.getDay(),hours:o.getHours(),fullHours:o.getHours()<10?"0"+o.getHours():o.getHours(),minutes:o.getMinutes(),fullMinutes:o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes()}};i.getDecade=function(o){var p=Math.floor(o.getFullYear()/10)*10;return[p,p+9]};i.template=function(p,o){return p.replace(/#\{([\w]+)\}/g,function(r,q){if(o[q]||o[q]===0){return o[q]}})};i.isSame=function(u,s,p){if(!u||!s){return false}var r=i.getParsedDate(u),q=i.getParsedDate(s),o=p?p:"day",t={day:r.date==q.date&&r.month==q.month&&r.year==q.year,month:r.month==q.month&&r.year==q.year,year:r.year==q.year};return t[o]};i.less=function(p,o,q){if(!p||!o){return false}return o.getTime()<p.getTime()};i.bigger=function(p,o,q){if(!p||!o){return false}return o.getTime()>p.getTime()};i.getLeadingZeroNum=function(o){return parseInt(o)<10?"0"+o:o};i.resetTime=function(o){if(typeof o!="object"){return}o=i.getParsedDate(o);return new Date(o.year,o.month,o.date)};b.fn.datepicker=function(o){return this.each(function(){if(!b.data(this,j)){b.data(this,j,new f(this,o))}else{var p=b.data(this,j);p.opts=b.extend(true,p.opts,o);p.update()}})};b.fn.datepicker.Constructor=f;b.fn.datepicker.language={ru:{days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.mm.yyyy",timeFormat:"hh:ii",firstDay:1}};b(function(){b(h).datepicker()})})();(function(){var d={days:'<div class="datepicker--days datepicker--body"><div class="datepicker--days-names"></div><div class="datepicker--cells datepicker--cells-days"></div></div>',months:'<div class="datepicker--months datepicker--body"><div class="datepicker--cells datepicker--cells-months"></div></div>',years:'<div class="datepicker--years datepicker--body"><div class="datepicker--cells datepicker--cells-years"></div></div>'},e=b.fn.datepicker,f=e.Constructor;e.Body=function(i,g,h){this.d=i;this.type=g;this.opts=h;this.$el=b("");if(this.opts.onlyTimepicker){return}this.init()};e.Body.prototype={init:function(){this._buildBaseHtml();this._render();this._bindEvents()},_bindEvents:function(){this.$el.on("click",".datepicker--cell",b.proxy(this._onClickCell,this))},_buildBaseHtml:function(){this.$el=b(d[this.type]).appendTo(this.d.$content);this.$names=b(".datepicker--days-names",this.$el);this.$cells=b(".datepicker--cells",this.$el)},_getDayNamesHtml:function(g,k,j,h){k=k!=c?k:g;j=j?j:"";h=h!=c?h:0;if(h>7){return j}if(k==7){return this._getDayNamesHtml(g,0,j,++h)}j+='<div class="datepicker--day-name'+(this.d.isWeekend(k)?" -weekend-":"")+'">'+this.d.loc.daysMin[k]+"</div>";return this._getDayNamesHtml(g,++k,j,++h)},_getCellContents:function(k,p){var l="datepicker--cell datepicker--cell-"+p,i=new Date(),q=this.d,m=f.resetTime(q.minRange),j=f.resetTime(q.maxRange),g=q.opts,o=f.getParsedDate(k),h={},n=o.date;switch(p){case"day":if(q.isWeekend(o.day)){l+=" -weekend-"}if(o.month!=this.d.parsedDate.month){l+=" -other-month-";if(!g.selectOtherMonths){l+=" -disabled-"}if(!g.showOtherMonths){n=""}}break;case"month":n=q.loc[q.opts.monthsField][o.month];break;case"year":var r=q.curDecade;n=o.year;if(o.year<r[0]||o.year>r[1]){l+=" -other-decade-";if(!g.selectOtherYears){l+=" -disabled-"}if(!g.showOtherYears){n=""}}break}if(g.onRenderCell){h=g.onRenderCell(k,p)||{};n=h.html?h.html:n;l+=h.classes?" "+h.classes:""}if(g.range){if(f.isSame(m,k,p)){l+=" -range-from-"}if(f.isSame(j,k,p)){l+=" -range-to-"}if(q.selectedDates.length==1&&q.focused){if((f.bigger(m,k)&&f.less(q.focused,k))||(f.less(j,k)&&f.bigger(q.focused,k))){l+=" -in-range-"}if(f.less(j,k)&&f.isSame(q.focused,k)){l+=" -range-from-"}if(f.bigger(m,k)&&f.isSame(q.focused,k)){l+=" -range-to-"}}else{if(q.selectedDates.length==2){if(f.bigger(m,k)&&f.less(j,k)){l+=" -in-range-"}}}}if(f.isSame(i,k,p)){l+=" -current-"}if(q.focused&&f.isSame(k,q.focused,p)){l+=" -focus-"}if(q._isSelected(k,p)){l+=" -selected-"}if(!q._isInRange(k,p)||h.disabled){l+=" -disabled-"}return{html:n,classes:l}},_getDaysHtml:function(j){var h=f.getDaysCount(j),l=new Date(j.getFullYear(),j.getMonth(),1).getDay(),p=new Date(j.getFullYear(),j.getMonth(),h).getDay(),q=l-this.d.loc.firstDay,g=6-p+this.d.loc.firstDay;q=q<0?q+7:q;g=g>6?g-7:g;var t=-q+1,k,s,o="";for(var n=t,r=h+g;n<=r;n++){s=j.getFullYear();k=j.getMonth();o+=this._getDayHtml(new Date(s,k,n))}return o},_getDayHtml:function(g){var h=this._getCellContents(g,"day");return'<div class="'+h.classes+'" data-date="'+g.getDate()+'" data-month="'+g.getMonth()+'" data-year="'+g.getFullYear()+'">'+h.html+"</div>"},_getMonthsHtml:function(g){var j="",k=f.getParsedDate(g),h=0;while(h<12){j+=this._getMonthHtml(new Date(k.year,h));h++}return j},_getMonthHtml:function(g){var h=this._getCellContents(g,"month");return'<div class="'+h.classes+'" data-month="'+g.getMonth()+'">'+h.html+"</div>"},_getYearsHtml:function(g){var m=f.getParsedDate(g),l=f.getDecade(g),k=l[0]-1,j="",h=k;for(h;h<=l[1]+1;h++){j+=this._getYearHtml(new Date(h,0))}return j},_getYearHtml:function(g){var h=this._getCellContents(g,"year");return'<div class="'+h.classes+'" data-year="'+g.getFullYear()+'">'+h.html+"</div>"},_renderTypes:{days:function(){var h=this._getDayNamesHtml(this.d.loc.firstDay),g=this._getDaysHtml(this.d.currentDate);this.$cells.html(g);this.$names.html(h)},months:function(){var g=this._getMonthsHtml(this.d.currentDate);this.$cells.html(g)},years:function(){var g=this._getYearsHtml(this.d.currentDate);this.$cells.html(g)}},_render:function(){if(this.opts.onlyTimepicker){return}this._renderTypes[this.type].bind(this)()},_update:function(){var g=b(".datepicker--cell",this.$cells),k=this,i,j,h;g.each(function(l,m){j=b(this);h=k.d._getDateFromCell(b(this));i=k._getCellContents(h,k.d.cellType);j.attr("class",i.classes)})},show:function(){if(this.opts.onlyTimepicker){return}this.$el.addClass("active");this.acitve=true},hide:function(){this.$el.removeClass("active");this.active=false},_handleClick:function(k){var h=k.data("date")||1,l=k.data("month")||0,j=k.data("year")||this.d.parsedDate.year,m=this.d;if(m.view!=this.opts.minView){m.down(new Date(j,l,h));return}var i=new Date(j,l,h),g=this.d._isSelected(i,this.d.cellType);if(!g){m._trigger("clickCell",i);return}m._handleAlreadySelectedDates.bind(m,g,i)()},_onClickCell:function(h){var g=b(h.target).closest(".datepicker--cell");if(g.hasClass("-disabled-")){return}this._handleClick.bind(this)(g)}}})();(function(){var f='<div class="datepicker--nav-action" data-action="prev">#{prevHtml}</div><div class="datepicker--nav-title">#{title}</div><div class="datepicker--nav-action" data-action="next">#{nextHtml}</div>',e='<div class="datepicker--buttons"></div>',d='<span class="datepicker--button" data-action="#{action}">#{label}</span>',g=b.fn.datepicker,h=g.Constructor;g.Navigation=function(j,i){this.d=j;this.opts=i;this.$buttonsContainer="";this.init()};g.Navigation.prototype={init:function(){this._buildBaseHtml();this._bindEvents()},_bindEvents:function(){this.d.$nav.on("click",".datepicker--nav-action",b.proxy(this._onClickNavButton,this));this.d.$nav.on("click",".datepicker--nav-title",b.proxy(this._onClickNavTitle,this));this.d.$datepicker.on("click",".datepicker--button",b.proxy(this._onClickNavButton,this))},_buildBaseHtml:function(){if(!this.opts.onlyTimepicker){this._render()}this._addButtonsIfNeed()},_addButtonsIfNeed:function(){if(this.opts.todayButton){this._addButton("today")}if(this.opts.clearButton){this._addButton("clear")}},_render:function(){var j=this._getTitle(this.d.currentDate),i=h.template(f,b.extend({title:j},this.opts));this.d.$nav.html(i);if(this.d.view=="years"){b(".datepicker--nav-title",this.d.$nav).addClass("-disabled-")}this.setNavStatus()},_getTitle:function(i){return this.d.formatDate(this.opts.navTitles[this.d.view],i)},_addButton:function(j){if(!this.$buttonsContainer.length){this._addButtonsContainer()}var k={action:j,label:this.d.loc[j]},i=h.template(d,k);if(b("[data-action="+j+"]",this.$buttonsContainer).length){return}this.$buttonsContainer.append(i)},_addButtonsContainer:function(){this.d.$datepicker.append(e);this.$buttonsContainer=b(".datepicker--buttons",this.d.$datepicker)},setNavStatus:function(){if(!(this.opts.minDate||this.opts.maxDate)||!this.opts.disableNavWhenOutOfRange){return}var j=this.d.parsedDate,i=j.month,n=j.year,l=j.date;switch(this.d.view){case"days":if(!this.d._isInRange(new Date(n,i-1,1),"month")){this._disableNav("prev")}if(!this.d._isInRange(new Date(n,i+1,1),"month")){this._disableNav("next")}break;case"months":if(!this.d._isInRange(new Date(n-1,i,l),"year")){this._disableNav("prev")}if(!this.d._isInRange(new Date(n+1,i,l),"year")){this._disableNav("next")}break;case"years":var k=h.getDecade(this.d.date);if(!this.d._isInRange(new Date(k[0]-1,0,1),"year")){this._disableNav("prev")}if(!this.d._isInRange(new Date(k[1]+1,0,1),"year")){this._disableNav("next")}break}},_disableNav:function(i){b('[data-action="'+i+'"]',this.d.$nav).addClass("-disabled-")},_activateNav:function(i){b('[data-action="'+i+'"]',this.d.$nav).removeClass("-disabled-")},_onClickNavButton:function(k){var i=b(k.target).closest("[data-action]"),j=i.data("action");this.d[j]()},_onClickNavTitle:function(i){if(b(i.target).hasClass("-disabled-")){return}if(this.d.view=="days"){return this.d.view="months"}this.d.view="years"}}})();(function(){var d='<div class="datepicker--time"><div class="datepicker--time-current">   <span class="datepicker--time-current-hours">#{hourVisible}</span>   <span class="datepicker--time-current-colon">:</span>   <span class="datepicker--time-current-minutes">#{minValue}</span></div><div class="datepicker--time-sliders">   <div class="datepicker--time-row">      <input type="range" name="hours" value="#{hourValue}" min="#{hourMin}" max="#{hourMax}" step="#{hourStep}"/>   </div>   <div class="datepicker--time-row">      <input type="range" name="minutes" value="#{minValue}" min="#{minMin}" max="#{minMax}" step="#{minStep}"/>   </div></div></div>',e=b.fn.datepicker,f=e.Constructor;e.Timepicker=function(h,g){this.d=h;this.opts=g;this.init()};e.Timepicker.prototype={init:function(){var g="input";this._setTime(this.d.date);this._buildHTML();if(navigator.userAgent.match(/trident/gi)){g="change"}this.d.$el.on("selectDate",this._onSelectDate.bind(this));this.$ranges.on(g,this._onChangeRange.bind(this));this.$ranges.on("mouseup",this._onMouseUpRange.bind(this));this.$ranges.on("mousemove focus ",this._onMouseEnterRange.bind(this));this.$ranges.on("mouseout blur",this._onMouseOutRange.bind(this))},_setTime:function(h){var g=f.getParsedDate(h);this._handleDate(h);this.hours=g.hours<this.minHours?this.minHours:g.hours;this.minutes=g.minutes<this.minMinutes?this.minMinutes:g.minutes},_setMinTimeFromDate:function(g){this.minHours=g.getHours();this.minMinutes=g.getMinutes();if(this.d.lastSelectedDate){if(this.d.lastSelectedDate.getHours()>g.getHours()){this.minMinutes=this.opts.minMinutes}}},_setMaxTimeFromDate:function(g){this.maxHours=g.getHours();this.maxMinutes=g.getMinutes();if(this.d.lastSelectedDate){if(this.d.lastSelectedDate.getHours()<g.getHours()){this.maxMinutes=this.opts.maxMinutes}}},_setDefaultMinMaxTime:function(){var h=23,g=59,i=this.opts;this.minHours=i.minHours<0||i.minHours>h?0:i.minHours;this.minMinutes=i.minMinutes<0||i.minMinutes>g?0:i.minMinutes;this.maxHours=i.maxHours<0||i.maxHours>h?h:i.maxHours;this.maxMinutes=i.maxMinutes<0||i.maxMinutes>g?g:i.maxMinutes},_validateHoursMinutes:function(g){if(this.hours<this.minHours){this.hours=this.minHours}else{if(this.hours>this.maxHours){this.hours=this.maxHours}}if(this.minutes<this.minMinutes){this.minutes=this.minMinutes}else{if(this.minutes>this.maxMinutes){this.minutes=this.maxMinutes}}},_buildHTML:function(){var g=f.getLeadingZeroNum,i={hourMin:this.minHours,hourMax:g(this.maxHours),hourStep:this.opts.hoursStep,hourValue:this.hours,hourVisible:g(this.displayHours),minMin:this.minMinutes,minMax:g(this.maxMinutes),minStep:this.opts.minutesStep,minValue:g(this.minutes)},h=f.template(d,i);this.$timepicker=b(h).appendTo(this.d.$datepicker);this.$ranges=b('[type="range"]',this.$timepicker);this.$hours=b('[name="hours"]',this.$timepicker);this.$minutes=b('[name="minutes"]',this.$timepicker);this.$hoursText=b(".datepicker--time-current-hours",this.$timepicker);this.$minutesText=b(".datepicker--time-current-minutes",this.$timepicker);if(this.d.ampm){this.$ampm=b('<span class="datepicker--time-current-ampm">').appendTo(b(".datepicker--time-current",this.$timepicker)).html(this.dayPeriod);this.$timepicker.addClass("-am-pm-")}},_updateCurrentTime:function(){var i=f.getLeadingZeroNum(this.displayHours),g=f.getLeadingZeroNum(this.minutes);this.$hoursText.html(i);this.$minutesText.html(g);if(this.d.ampm){this.$ampm.html(this.dayPeriod)}},_updateRanges:function(){this.$hours.attr({min:this.minHours,max:this.maxHours}).val(this.hours);this.$minutes.attr({min:this.minMinutes,max:this.maxMinutes}).val(this.minutes)},_handleDate:function(g){this._setDefaultMinMaxTime();if(g){if(f.isSame(g,this.d.opts.minDate)){this._setMinTimeFromDate(this.d.opts.minDate)}else{if(f.isSame(g,this.d.opts.maxDate)){this._setMaxTimeFromDate(this.d.opts.maxDate)}}}this._validateHoursMinutes(g)},update:function(){this._updateRanges();this._updateCurrentTime()},_getValidHoursFromDate:function(k,j){var l=k,h=k;if(k instanceof Date){l=f.getParsedDate(k);h=l.hours}var g=j||this.d.ampm,i="am";if(g){switch(true){case h==0:h=12;break;case h==12:i="pm";break;case h>11:h=h-12;i="pm";break;default:break}}return{hours:h,dayPeriod:i}},set hours(h){this._hours=h;var g=this._getValidHoursFromDate(h);this.displayHours=g.hours;this.dayPeriod=g.dayPeriod},get hours(){return this._hours},_onChangeRange:function(i){var g=b(i.target),h=g.attr("name");this.d.timepickerIsActive=true;this[h]=g.val();this._updateCurrentTime();this.d._trigger("timeChange",[this.hours,this.minutes]);this._handleDate(this.d.lastSelectedDate);this.update()},_onSelectDate:function(h,g){this._handleDate(g);this.update()},_onMouseEnterRange:function(h){var g=b(h.target).attr("name");b(".datepicker--time-current-"+g,this.$timepicker).addClass("-focus-")},_onMouseOutRange:function(h){var g=b(h.target).attr("name");if(this.d.inFocus){return}b(".datepicker--time-current-"+g,this.$timepicker).removeClass("-focus-")},_onMouseUpRange:function(g){this.d.timepickerIsActive=false}}})()})(window,jQuery);